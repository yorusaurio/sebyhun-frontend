# üß™ COMANDOS DE TESTING - BACKEND SPRING BOOT

Este archivo contiene todos los comandos curl para probar tu backend Spring Boot.

## üîß Variables de Entorno

```bash
# URL base del backend (cambia por tu URL de producci√≥n)
export API_BASE_URL="http://localhost:8080/api"

# ID de usuario para testing
export TEST_USER_ID="test-user-123"
```

## üìã COMANDOS B√ÅSICOS

### 1. Health Check
```bash
curl -X GET "${API_BASE_URL}/health" \
  -H "accept: */*"
```

### 2. Listar Recuerdos
```bash
curl -X GET "${API_BASE_URL}/recuerdos?userId=${TEST_USER_ID}" \
  -H "accept: */*"
```

### 3. Crear Recuerdo
```bash
curl -X POST "${API_BASE_URL}/recuerdos" \
  -H "Content-Type: application/json" \
  -d '{
    "userId": "'${TEST_USER_ID}'",
    "titulo": "Recuerdo de Prueba",
    "descripcion": "Este es un recuerdo creado para testing",
    "ubicacion": "Madrid, Espa√±a",
    "fecha": "2024-12-25",
    "imagenes": ["https://i.ibb.co/xyz/test.jpg"],
    "latitud": 40.4168,
    "longitud": -3.7038
  }'
```

### 4. Obtener Recuerdo por ID
```bash
# Primero necesitas el ID del recuerdo creado
curl -X GET "${API_BASE_URL}/recuerdos/1" \
  -H "accept: */*"
```

### 5. Actualizar Recuerdo
```bash
curl -X PUT "${API_BASE_URL}/recuerdos/1" \
  -H "Content-Type: application/json" \
  -d '{
    "userId": "'${TEST_USER_ID}'",
    "titulo": "Recuerdo Actualizado",
    "descripcion": "Descripci√≥n actualizada desde curl",
    "ubicacion": "Barcelona, Espa√±a",
    "fecha": "2024-12-26",
    "imagenes": ["https://i.ibb.co/updated/test.jpg"],
    "latitud": 41.3851,
    "longitud": 2.1734
  }'
```

### 6. Eliminar Recuerdo
```bash
curl -X DELETE "${API_BASE_URL}/recuerdos/1" \
  -H "accept: */*"
```

## üîç COMANDOS DE B√öSQUEDA

### 7. Buscar por T√≠tulo
```bash
curl -X GET "${API_BASE_URL}/recuerdos/search?userId=${TEST_USER_ID}&titulo=prueba" \
  -H "accept: */*"
```

### 8. Buscar por Ubicaci√≥n
```bash
curl -X GET "${API_BASE_URL}/recuerdos/search?userId=${TEST_USER_ID}&ubicacion=madrid" \
  -H "accept: */*"
```

## üìä COMANDOS DE ESTAD√çSTICAS

### 9. Obtener Estad√≠sticas
```bash
curl -X GET "${API_BASE_URL}/stats/${TEST_USER_ID}" \
  -H "accept: */*"
```

## üìÖ COMANDOS DE CALENDARIO

### 10. Calendario Mensual
```bash
curl -X GET "${API_BASE_URL}/calendar/${TEST_USER_ID}?year=2024&month=12" \
  -H "accept: */*"
```

### 11. Calendario Anual
```bash
curl -X GET "${API_BASE_URL}/calendar/${TEST_USER_ID}/year?year=2024" \
  -H "accept: */*"
```

## üéØ SCRIPT DE TESTING COMPLETO

```bash
#!/bin/bash

# Configuraci√≥n
API_BASE_URL="http://localhost:8080/api"
TEST_USER_ID="test-user-123"

echo "ü©∫ Testing Backend Spring Boot..."

# 1. Health Check
echo "üìã 1. Health Check"
curl -s "${API_BASE_URL}/health" | jq '.'

# 2. Listar recuerdos (deber√≠a estar vac√≠o inicialmente)
echo "üìã 2. Listar recuerdos vac√≠os"
curl -s "${API_BASE_URL}/recuerdos?userId=${TEST_USER_ID}" | jq '.'

# 3. Crear recuerdo de prueba
echo "üìã 3. Crear recuerdo de prueba"
CREATED_RESPONSE=$(curl -s -X POST "${API_BASE_URL}/recuerdos" \
  -H "Content-Type: application/json" \
  -d '{
    "userId": "'${TEST_USER_ID}'",
    "titulo": "Viaje de Testing",
    "descripcion": "Recuerdo creado autom√°ticamente para testing",
    "ubicacion": "Madrid, Espa√±a",
    "fecha": "2024-12-25",
    "imagenes": ["https://i.ibb.co/testing/madrid.jpg"],
    "latitud": 40.4168,
    "longitud": -3.7038
  }')

echo $CREATED_RESPONSE | jq '.'

# Extraer el ID del recuerdo creado
RECUERDO_ID=$(echo $CREATED_RESPONSE | jq -r '.id')

if [ "$RECUERDO_ID" != "null" ]; then
  echo "üìã 4. Recuerdo creado con ID: $RECUERDO_ID"
  
  # 4. Obtener el recuerdo por ID
  echo "üìã 5. Obtener recuerdo por ID"
  curl -s "${API_BASE_URL}/recuerdos/${RECUERDO_ID}" | jq '.'
  
  # 5. Actualizar el recuerdo
  echo "üìã 6. Actualizar recuerdo"
  curl -s -X PUT "${API_BASE_URL}/recuerdos/${RECUERDO_ID}" \
    -H "Content-Type: application/json" \
    -d '{
      "userId": "'${TEST_USER_ID}'",
      "titulo": "Viaje de Testing ACTUALIZADO",
      "descripcion": "Recuerdo actualizado autom√°ticamente",
      "ubicacion": "Barcelona, Espa√±a",
      "fecha": "2024-12-26",
      "imagenes": ["https://i.ibb.co/testing/barcelona.jpg"],
      "latitud": 41.3851,
      "longitud": 2.1734
    }' | jq '.'
  
  # 6. Buscar recuerdos
  echo "üìã 7. Buscar por t√≠tulo"
  curl -s "${API_BASE_URL}/recuerdos/search?userId=${TEST_USER_ID}&titulo=testing" | jq '.'
  
  echo "üìã 8. Buscar por ubicaci√≥n"
  curl -s "${API_BASE_URL}/recuerdos/search?userId=${TEST_USER_ID}&ubicacion=barcelona" | jq '.'
  
  # 7. Estad√≠sticas
  echo "üìã 9. Obtener estad√≠sticas"
  curl -s "${API_BASE_URL}/stats/${TEST_USER_ID}" | jq '.'
  
  # 8. Calendario
  echo "üìã 10. Calendario mensual"
  curl -s "${API_BASE_URL}/calendar/${TEST_USER_ID}?year=2024&month=12" | jq '.'
  
  echo "üìã 11. Calendario anual"
  curl -s "${API_BASE_URL}/calendar/${TEST_USER_ID}/year?year=2024" | jq '.'
  
  # 9. Eliminar el recuerdo de prueba
  echo "üìã 12. Eliminar recuerdo de prueba"
  curl -s -X DELETE "${API_BASE_URL}/recuerdos/${RECUERDO_ID}" | jq '.'
  
  # 10. Verificar que se elimin√≥
  echo "üìã 13. Verificar lista vac√≠a despu√©s de eliminar"
  curl -s "${API_BASE_URL}/recuerdos?userId=${TEST_USER_ID}" | jq '.'
  
else
  echo "‚ùå Error: No se pudo crear el recuerdo de prueba"
fi

echo "‚úÖ Testing completado"
```

## üöÄ INSTRUCCIONES DE USO

### Para Windows (PowerShell):
1. Define las variables:
   ```powershell
   $API_BASE_URL = "http://localhost:8080/api"
   $TEST_USER_ID = "test-user-123"
   ```

2. Ejecuta los comandos reemplazando `${API_BASE_URL}` por `$API_BASE_URL`

### Para Linux/Mac:
1. Guarda el script como `test-backend.sh`
2. Dale permisos de ejecuci√≥n: `chmod +x test-backend.sh`
3. Ejecuta: `./test-backend.sh`

### Para testing r√°pido:
```bash
# Solo health check
curl http://localhost:8080/api/health

# Solo listar recuerdos
curl "http://localhost:8080/api/recuerdos?userId=test"
```

## üîß TROUBLESHOOTING

### Backend no responde:
```bash
# Verificar que el backend est√© ejecut√°ndose
curl -v http://localhost:8080/api/health
```

### Error de CORS:
- Verifica que tu backend Spring Boot tenga configurado CORS para permitir `http://localhost:3000`

### Error 404:
- Verifica que los endpoints est√©n implementados en tu backend
- Verifica que la URL base sea correcta

### Error de formato JSON:
- Usa herramientas como `jq` para formatear la salida JSON
- En Windows puedes usar `| ConvertFrom-Json | ConvertTo-Json -Depth 10`

## üìç Pruebas Espec√≠ficas del Sistema de Ubicaciones

### üß™ Casos de Prueba para Autocompletado

#### **Caso 1: Selecci√≥n Correcta**
```
1. Ir a "Nuevo Lugar"
2. En el campo ubicaci√≥n, escribir "Torre Eif"
3. Esperar a que aparezcan sugerencias
4. Hacer CLIC en "Torre Eiffel, Par√≠s, Francia"
5. ‚úÖ ESPERADO: Campo verde con ‚úì, coordenadas visibles abajo
6. ‚úÖ ESPERADO: Formulario puede guardarse sin errores
```

#### **Caso 2: Escritura Manual (Error)**
```
1. Ir a "Nuevo Lugar"
2. En el campo ubicaci√≥n, escribir "Torre Eiffel"
3. Hacer clic fuera del campo SIN seleccionar sugerencia
4. ‚ùå ESPERADO: Campo amarillo con ‚ö†, sin coordenadas
5. ‚ùå ESPERADO: Al intentar guardar, muestra error de validaci√≥n
```

#### **Caso 3: Campo Vac√≠o**
```
1. Ir a "Nuevo Lugar"
2. Dejar campo ubicaci√≥n vac√≠o
3. ‚ùå ESPERADO: Al intentar guardar, muestra "La ubicaci√≥n es obligatoria"
```

#### **Caso 4: Borrar Selecci√≥n Previa**
```
1. Seleccionar una ubicaci√≥n v√°lida (caso 1)
2. Borrar todo el texto del campo
3. ‚úÖ ESPERADO: Coordenadas se limpian autom√°ticamente
4. ‚úÖ ESPERADO: Campo vuelve al estado inicial
```

#### **Caso 5: Cambiar Selecci√≥n**
```
1. Seleccionar "Torre Eiffel, Par√≠s, Francia"
2. Borrar y escribir "Statue of Lib"
3. Seleccionar "Statue of Liberty, New York"
4. ‚úÖ ESPERADO: Coordenadas se actualizan a Nueva York
5. ‚úÖ ESPERADO: El campo mantiene estado verde
```

### üîç Validaciones T√©cnicas

#### **Verificar Coordenadas en Consola**
```javascript
// Abrir DevTools > Console
// Escribir una ubicaci√≥n y seleccionar
// Buscar logs como:
‚úÖ Lugar seleccionado exitosamente: {
  ubicacion: "Torre Eiffel, Par√≠s, Francia",
  latitud: 48.8584,
  longitud: 2.2945,
  place_id: "ChIJLU7jZClu5kcR4PcOOO6p3I0"
}
```

#### **Verificar Estado del Formulario**
```javascript
// En la consola del navegador:
// Despu√©s de seleccionar una ubicaci√≥n v√°lida
console.log('Estado del formulario:', formData);
// Debe mostrar latitud y longitud definidas
```

### üéØ Flujo Completo de Creaci√≥n de Recuerdo

```
1. Abrir http://localhost:3000/nuevo-lugar
2. Llenar t√≠tulo: "D√≠a rom√°ntico en Par√≠s"
3. Llenar descripci√≥n: "Visitamos la Torre Eiffel al atardecer"
4. En ubicaci√≥n: escribir "Torre Eiffel" y SELECCIONAR la sugerencia
5. Seleccionar fecha: hoy
6. Subir una imagen
7. ‚úÖ ESPERADO: Bot√≥n "Crear Recuerdo" habilitado
8. Hacer clic en "Crear Recuerdo"
9. ‚úÖ ESPERADO: Redirige a /home sin errores
10. ‚úÖ ESPERADO: El recuerdo aparece en la lista con ubicaci√≥n correcta
11. Ir a /mapa
12. ‚úÖ ESPERADO: El recuerdo aparece en el mapa en la ubicaci√≥n correcta
```

### üö® Casos de Error Espec√≠ficos

#### **Error: Ubicaci√≥n Sin Coordenadas**
```
Mensaje: "Por favor, selecciona una ubicaci√≥n de las sugerencias para obtener coordenadas precisas"
Soluci√≥n: Volver a escribir y hacer clic en una sugerencia
```

#### **Error: API de Google Maps No Cargada**
```
Indicador: "Cargando API" en amarillo permanente
Verificaci√≥n: 
1. Comprobar NEXT_PUBLIC_GOOGLE_MAPS_API_KEY en .env.local
2. Verificar consola por errores de API
3. Verificar l√≠mites de cuota de Google Maps API
```

### üìä M√©tricas de √âxito

- ‚úÖ 100% de ubicaciones tienen coordenadas v√°lidas
- ‚úÖ 0 errores de geocodificaci√≥n
- ‚úÖ Feedback visual inmediato al usuario
- ‚úÖ Prevenci√≥n de errores antes del env√≠o
- ‚úÖ Integraci√≥n perfecta con el mapa

### üîß Debug Avanzado

#### **Logs de Autocompletado**
```
üöÄ Iniciando carga de Google Places API...
üì¶ Google Maps API cargada, importando librer√≠a Places...
‚úÖ Places Library importada correctamente
üåé Google Places API (nueva versi√≥n) cargada correctamente
üîÑ Inicializando autocompletado porque Places API fue cargada
‚úÖ Autocompletado reiniciado exitosamente
```

#### **Logs de Selecci√≥n**
```
üìç Lugar obtenido del autocompletado: [Place Object]
‚úÖ Lugar seleccionado exitosamente: {ubicacion, latitud, longitud, place_id}
üìå Actualizando FormData con nueva ubicaci√≥n
```

#### **Logs de Validaci√≥n**
```
üìç Actualizando ubicaci√≥n antes de validar: [ubicaci√≥n]
üíæ handleSubmit - Iniciando proceso de guardado:
üìç Usando coordenadas del autocompletado: {latitud, longitud, ubicacion}
```
